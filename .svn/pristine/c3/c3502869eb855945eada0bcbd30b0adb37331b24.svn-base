/**
 * <pre>
 * 
 * </pre>
 * @author 작성자명
 * @since 2023. 11. 25.
 * @version 1.0
 * <pre>
 * [[개정이력(Modification Information)]]
 * 수정일        	수정자       수정내용
 * --------     	--------    ----------------------
 * 2023. 11. 25.    김보영       최초작성
 * 2023. 11. 25.    김보영       등록
 * 2023. 11. 27.    김보영       목록
 * Copyright (c) 2023 by DDIT All right reserved
 * </pre>
 */ 

//-----------------------------------------------

//분류에 따른 게시글 목록 조회

function fn_boardList(eventSttus) {

	let settings = {
		url : '/event/list',
		contentType: 'application/json',
		method: "get",
		data : {
			eventSttus : eventSttus
		},
		dataType: "json"
	};
	
	let tag ="";
	
	$.ajax(settings)
		.done(function(resp){
			let pagingEventList = resp.paging.dataList;
			if(pagingEventList[0] != null){
				
				let classIndex = 0;
			
				 $.each(pagingEventList, function(i, v) {
				 
				 	const rndColor = ['alert-primary','alert-info', 'alert-success', 'alert-warning']; 
				 	let alertClass = rndColor[classIndex];
				 	classIndex = (classIndex + 1) % rndColor.length;
				 	
				 	if (v.eventSttus == "1") {
					 	//결혼/출산게시판
				 		tag +=`
							<div class="alert ${alertClass}">
				 				<div class="row g-2">
				 					<div class="col-md-8 col-lg-8">
										<h5 class="alert-heading fw-medium mb-1"><i class='bx bx-message-square-detail'></i> ${v.bbsSj}</h5>
									</div>
				 					<div class="col-md-4 col-lg-4" style="text-align: right;">
										${v.eventRdate}
									</div>
								</div>
							</div>
						`;
						$("#WBArea").html(tag);
				 		
				 	}else if(v.eventSttus == "2"){
				 		//사망
				 		tag +=`
							<div class="alert ${alertClass}">
				 				<div class="row g-2">
				 					<div class="col-md-8 col-lg-8">
										<h5 class="alert-heading fw-medium mb-1"><i class='bx bx-message-square-detail'></i> ${v.bbsSj}</h5>
									</div>
				 					<div class="col-md-4 col-lg-4" style="text-align: right;">
										${v.eventRdate}
									</div>
								</div>
							</div>
						`;
						$("#deadArea").html(tag);
				 		
				 	
				 	}else if(v.eventSttus == "3"){
				 		//생일
				 		tag +=`
							<div class="alert ${alertClass}">
				 				<div class="row g-2">
				 					<div class="col-md-8 col-lg-8">
										<h5 class="alert-heading fw-medium mb-1"><i class='bx bx-message-square-detail'></i> ${v.bbsSj}</h5>
									</div>
				 					<div class="col-md-4 col-lg-4" style="text-align: right;">
										${v.eventRdate}
									</div>
								</div>
							</div>
						`;
						$("#birthArea").html(tag);
				 		
				 	
				 	}else if(v.eventSttus == "4"){
				 		//기타
				 		tag +=`
							<div class="alert ${alertClass}">
				 				<div class="row g-2">
				 					<div class="col-md-8 col-lg-8">
										<h5 class="alert-heading fw-medium mb-1"><i class='bx bx-message-square-detail'></i> ${v.bbsSj}</h5>
									</div>
				 					<div class="col-md-4 col-lg-4" style="text-align: right;">
										${v.eventRdate}
									</div>
								</div>
							</div>
						`;
						$("#etcArea").html(tag);
				 	}
				 	
				 });
				 //페이징버튼
				 tag=`
				 	${resp.paging.pagingHTML}
				 	<form id="searchForm">
						<div id ="searchUI" class="row g-3 d-flex justify-content-center">
							<input type="hidden" name="page" readonly="readonly"/>
							<div class="col-auto">
								<select name=" searchType" class="form-select"> 
									<option value="bbsSj" >제목</option>
								</select>
							</div>
							<div class="col-auto">
								<input name="searchWord" placeholder="입력하세요" class="form-control" />
							</div>
							<div class="col-auto">
								<input type="button" value="검색" id="searchBtn" class="btn btn-primary" />
							</div>
						</div>
					</form>
				 `;
				 $("#eventPaging").html(tag);
			}
			
	});
}


//페이징 버튼 클릭
function fn_paging(page) {
	searchForm.page.value = page;
	fn_boardList();
}

//검색 버튼 클릭
$(document).on("click", "#searchBtn", function(){
	fn_boardList();
});







//경조사게시판 등록 비동기

function fn_insertEvent(){

	//저장확인모달창
	fn_swalConfirm("글을 등록하시겠습니까?", function(){
		//비동기
		var data = new FormData($("#formEvent")[0]);
		var bbsCn = CKEDITOR.instances.bbsCn.getData();
		data.append("bbsCn", bbsCn);

		$.ajax({
			type: "POST",
			enctype: 'multipart/form-data',
			url: "/event/insert",
			data: data,
			processData: false,
			contentType: false,
			cache: false,
			success: function (data) {
				var text;
				var icon;
				if (data.success == "Y") {
					text = "등록이 완료되었습니다.";
					icon = "success";
				} else {
					text = "등록이 실패되었습니다.";
					icon = "warning";
				}
				//모달창열기
				fn_swalComplete(text, icon, "/event/home", data.success);
			},
			error: function () {
				fn_swalError();
			}
		});
	});


}





//이벤트 등록폼 
function fn_eventForm(){
	
	location.href ='/event/form';
}


