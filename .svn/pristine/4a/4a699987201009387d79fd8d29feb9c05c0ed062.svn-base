<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.admin.attendance.dao.AdminAttendanceDAO">

	<resultMap type="AttendanceVO" id="attendanceMap" autoMapping="true">
		<id property="attDate" column="ATT_DATE"/>
		<id property="empCd" column="EMP_CD"/>
		<collection property="alList" ofType="AttendanceLogVO" autoMapping="true"/>
	</resultMap>
	
	<select id="attendanceList" resultType="AttendanceVO" parameterType="String">
		SELECT ATT_DATE, EMP_CD, START_TIME, END_TIME, FN_GET_EMP_NAME(EMP_CD) EMP_NAME, FN_GET_DEPT_NAME(EMP_CD) DEPT_NAME
		FROM ATTENDANCE
		WHERE ATT_DATE LIKE #{date}
        ORDER BY EMP_CD,ATT_DATE
	</select>
	
	<select id="selectEmp" parameterType="String" resultType="EmployeeVO">
		SELECT EMP_CD, EMP_NAME, FN_GET_DEPT_NAME(EMP_CD) DEPT_CD
		FROM EMPLOYEE
		WHERE EMP_CD=#{empCd}
	</select>
	
	<select id="adminAttendanceMonth" parameterType="Map" resultMap="attendanceMap">
		SELECT A.ATT_DATE ATT_DATE,A.EMP_CD EMP_CD,START_TIME,END_TIME,ATT_LOG,ATT_LOG_TIME
		FROM ATTENDANCE A LEFT OUTER JOIN ATTENDANCE_LOG AL
			ON A.ATT_DATE=AL.ATT_DATE AND A.EMP_CD=AL.EMP_CD
		WHERE A.EMP_CD=#{empCd} AND A.ATT_DATE LIKE #{attendanceDate}
		ORDER BY A.ATT_DATE
	</select>
	
	<select id="vacationList" parameterType="Map" resultType="VacationVO">
		SELECT V_SDAY, EMP_CD, V_FLAG, V_WHY, V_EDAY
		FROM VACATION
		WHERE EMP_CD=#{empCd} AND
		<![CDATA[
			V_SDAY LIKE #{attendanceDate} OR V_EDAY LIKE #{attendanceDate}
        ]]>
	</select>
</mapper>