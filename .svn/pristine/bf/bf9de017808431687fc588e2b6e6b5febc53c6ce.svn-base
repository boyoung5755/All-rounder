<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--  [[개정이력(Modification Information)]]       -->
<!--  수정일         수정자     수정내용               -->
<!--  ==========   ======    ==============        -->
<!--  2023. 11. 17.  전수진     최초작성               -->
<!--  2023. 11. 18.  전수진     즐겨찾기 리스트, 상세보기 구현    -->
<!--  Copyright (c) 2023 by DDIT All right reserved -->
<mapper namespace="kr.or.ddit.groupware.sanction.dao.BookmarkDAO">

	<!-- 즐겨찾기 추가 
	bkmkNo=null, bkmkOwner=E220901003, bkmkNm=안녕, bkmkNote=null, 
	-->
	<insert id="insertBookmark" parameterType="BookmarkVO">
	<selectKey order="BEFORE" keyProperty="bkmkNo" resultType="String">
		SELECT 
			'BK'||#{bkmkOwner}|| 
			LPAD(NVL(TO_NUMBER(SUBSTR(MAX(BKMK_NO), LENGTH('BK'||#{bkmkOwner})+1)), 0)+1, 3, '0')
		FROM BOOKMARK
	</selectKey>
		INSERT INTO BOOKMARK (
		    BKMK_NO			/* 즐겨찾기번호 */
		    , BKMK_OWNER	/* 즐겨찾기소유자 */
		    , BKMK_NM		/* 즐겨찾기이름 */
		) VALUES (
			#{bkmkNo}
		    , #{bkmkOwner}
		    , #{bkmkNm}
		)
	</insert>

	<!-- 즐겨찾기상세 추가 -->
	<insert id="insertBookmarkDetail" parameterType="BookmarkDetailVO">
		INSERT INTO BOOKMARK_DETAIL (
		    BKMK_DETAIL_NO	/* 즐겨찾기상세번호 */
		    , BKMK_NO		/* 즐겨찾기번호 */
		    , SANCTN_ORDR	/* 결재순서 */
		    , SANCTNER		/* 결재자 */
		) VALUES (
		    BKMKDETAIL_SEQ.NEXTVAL
		    , #{bkmkNo}
		    , #{sanctnOrdr}
		    , #{sanctner}
		)
	</insert>
	
	<!-- 즐겨찾기 리스트 -->
	<select id="selectBookmarkList" parameterType="String" resultType="BookmarkVO">
		SELECT
		    BKMK_NO 		/* 즐겨찾기 번호 */
		    , BKMK_OWNER	/* 즐겨찾기 소유자 */
		    , BKMK_NM		/* 즐겨찾기 이름 */
		FROM
		    BOOKMARK
		WHERE  BKMK_OWNER = #{sanctnOrdr}
		ORDER BY BKMK_NO ASC
	</select>
	
	<!-- 즐겨찾기 상세조회 -->
	<resultMap type="BookmarkDetailVO" id="detailMap">
		<id property="bkmkDetailNo" column="BKMK_DETAIL_NO"/>
		<result property="bkmkNo" column="BKMK_NO"/>
		<result property="sanctnOrdr" column="SANCTN_ORDR"/>
		<result property="sanctner" column="SANCTNER"/>
		<association property="bookmark" javaType="BookmarkVO" autoMapping="true">
			<id property="bkmkNo" column="BKMK_NO"/>
			<association property="emp" javaType="EmployeeVO" autoMapping="true">
				<id property="empCd" column="EMP_CD" />
				<association property="common" javaType="CommonVO" autoMapping="true" />
			</association>
		</association>
	</resultMap>
	<select id="selectBookmarkDetailList" parameterType="String" resultMap="detailMap">
		SELECT
		    D.BKMK_DETAIL_NO	/* 즐겨찾기상세번호 */
		    , D.BKMK_NO
		    , D.SANCTN_ORDR
		    , D.SANCTNER
		    , E.EMP_CD
		    , E.EMP_NAME
            , C.COMMON_CODE_SJ
		FROM
		    BOOKMARK_DETAIL D INNER JOIN BOOKMARK B ON (D.BKMK_NO = B.BKMK_NO)
			    INNER JOIN EMPLOYEE E ON(D.SANCTNER = E.EMP_CD)
	            INNER JOIN COMMON_CODE C ON (E.EMP_RANK = C.COMMON_CODE_CD)
		WHERE
		    D.BKMK_NO=#{bkmkNo}
        ORDER BY D.SANCTN_ORDR ASC
	</select>
	

</mapper>