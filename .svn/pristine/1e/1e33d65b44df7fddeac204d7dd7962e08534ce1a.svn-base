/**
 * <pre>
 * 
 * </pre>
 * @author 작성자명
 * @since 2023. 11. 30.
 * @version 1.0
 * <pre>
 * [[개정이력(Modification Information)]]
 * 수정일        수정자       수정내용
 * --------     --------    ----------------------
 * 2023. 11. 30.      오경석       최초작성
 * Copyright (c) 2023 by DDIT All right reserved
 * </pre>
 */


function freeList() {

		console.log("!!")
	$.ajax({
		type: "get",
		url: "/free/list",
		contentType: "application/json; charset=UTF-8",
		dataType: "json",
		success: function(res) {
			let tag = res.paging.pagingHTML;
			let list = res.paging.dataList;
			if(list[0] != null){
				
				let freeboardList = "";
				
				list.forEach((item) => {
					let day = item.bbsRgsde;
					let date = `${day[0]}-${day[1]}-${day[2]}`;
	
					let html = `	
					<div class="col-sm-6 col-lg-4">	
						<div class="card p-2 h-100 shadow-none border">
							<div class="rounded-2 text-center mb-3">
								<a href="app-academy-course-details.html"><img class="img-fluid" src="https://png.pngtree.com/png-vector/20191115/ourmid/pngtree-beautiful-profile-line-vector-icon-png-image_1990469.jpg" alt="tutor image 1"></a>
							</div>
							<div class="card-body p-3 pt-2">
								<div class="d-flex justify-content-between align-items-center mb-3 pe-xl-3 pe-xxl-0">
									<h6 class="d-flex align-items-center justify-content-center gap-1 mb-0">
										${item.empName} <span class="text-warning"><i class="bx bxs-star me-1"></i></span><span class="text-muted"> (${item.empCd})</span>
									</h6>
								</div>
								<a href="javascript:void(0);" onclick="selectFree(${item.bbsNo})" data-freeNo="${item.bbsNo}" id="freeBBSNo"class="h5" >${item.bbsSj}</a>
								<p class="mt-2">${item.bbsCn}</p>
								<p class="d-flex align-items-center">
									<i class="bx bx-time-five me-2"></i>${date}
								</p>
							</div>
						</div>	
					</div>			
					`;
					freeboardList += html;		
				});
				document.getElementById("freeboardList").innerHTML=freeboardList;
				//document.querySelector(".freePage").innerHTML=tag;				
			}

		},
		error: function(xhr) {
			alert("2")
			console.log(xhr);
		}
	});

}
freeList();
function selectFree(bbsNo){
	console.log("1")
	console.log(document.getElementById("freeBBSNo"))
	let url = "/free/"+bbsNo;
	console.log(url)
	let jsondata = {
		"bbsNo":bbsNo
		}
console.log(jsondata)		
	$.ajax({
		type:"post",
		url:url,
		contentType: "application/json; charset=UTF-8",
		data:JSON.stringify(jsondata),
		dataType:"json",
		success:function(res){
			console.log(res)
			document.getElementById("freeboardList").style.display="none";
			document.getElementById("serachFree").style.display="none";
			
			let day = res.bbsRgsde;
			let date = `${day[0]}-${day[1]}-${day[2]}`;	
			
					
			let html = `

				    <!-- 수정, 삭제 기능 -->
				    <div id="editDelete">
				        <button id="editBtn">수정</button>
				        <button id="deleteBtn">삭제</button>
				    </div>


				<div class="d-flex justify-content-between align-items-center flex-wrap mb-2 gap-1">
					<div class="me-1">
						<h5 class="mb-1">(제목) ${res.bbsSj}</h5>
						<p class="mb-1">(게시판번호) ${res.bbsNo} <span class="fw-medium"> (작성자사번) </span></p>
					</div>
					<div class="d-flex align-items-center">
						<i class="bx bx-share-alt bx-sm mx-4"></i>
						<i class="bx bx-bookmarks bx-sm"></i>
					</div>
				</div>

				<div class="card academy-content shadow-none border">
					<div class="p-2">
						<div class="cursor-pointer">
							<div class="plyr plyr--full-ui plyr--video plyr--html5 plyr--fullscreen-enabled plyr--paused plyr--stopped plyr--pip-supported plyr__poster-enabled" style="border-radius: 7px;">
								<div class="plyr__video-wrapper">
									<img class="w-100" src="https://png.pngtree.com/png-vector/20191115/ourmid/pngtree-beautiful-profile-line-vector-icon-png-image_1990469.jpg" alt="tutor image 1">
								</div>
							</div>
						</div>
					</div>
					<div class="card-body">
						<h5 class="mb-2">제목</h5>
						<p class="mb-0 pt-1">${res.bbsSj}</p>
				
						<hr class="mb-4 mt-2">
						<h5>내용</h5>
						<p class="mb-4">${res.bbsCn}</p>
						<hr class="my-4">
						<h5>정보</h5>
						<div class="d-flex flex-wrap">
							<div class="me-5">
								<p class="text-nowrap">
									<i class="bx bx-check-double bx-sm me-2"></i>작성글번호 ${res.bbsNo}
								</p>
								<p class="text-nowrap">
									<i class="bx bx-user bx-sm me-2"></i>작성자 ${res.empName}
								</p>
								<p class="text-nowrap">
									<i class="bx bx-pencil bx-sm me-2"></i>작성자사번 ${res.empCd}
								</p>
								<p class="text-nowrap">
									<i class="bx bxs-watch bx-sm me-2"></i>작성날짜 ${date}
								</p>
								<p class="text-nowrap">
									<i class="bx bxs-flag-alt bx-sm me-2"></i>Languages: English
								</p>
								<p class="text-nowrap">
									<i class="bx bx-file bx-sm me-2"></i>Captions: Yes
								</p>
							</div>
							<div>
							</div>
						</div>
						<hr class="my-4">
						<h5>댓글</h5>
						
			
			
				`;
				let anser = res.anserList;
				console.log(anser)
				anser.forEach((v)=>{
					console.log(v.answerWrter)
					console.log(v.answerCn)
					console.log(v.answerRgsde)
					console.log(v.answerWrterName)
					console.log(v.answerCode)
					console.log(v.answerUpcode)
					console.log(v)
					console.log("----------------")				
					
					if(v.answerUpcode == null ){
						html += `
						<div class="d-flex justify-content-start align-items-center user-name">
						        <!-- 댓글 목록 표시 -->
						
							<div class="avatar-wrapper">
								<p class="text-nowrap"> <i class="bx bx-user bx-sm me-2">(작성자) ${v.answerWrterName}</i>(작성코드) ${v.answerCode}, (작성자) ${v.answerWrterName}, (작성자사번) ${v.answerWrter}</p>
							</div>
							<div class="d-flex flex-column">
								<small class="text-muted">(작성날짜) ${v.answerRgsde}</small><span class="fw-medium">(작성 내용) ${v.answerCn}</span> 
							</div>
							<div>
								<button class="replyBtn" onclick="submitCommentBtnRe(this)" value="${v.answerCode}" id="reAnswer">대댓글</button>
							</div>
						`;	

			            anser.forEach((reply) => {
			                console.log(reply)
							if(reply.answerUpcode != null && v.answerCode == reply.answerUpcode){
								html += `
									<!-- 대댓글 입력 양식 -->
	
									
									<div class="reply">
										<p>1111</p><p>작성자 ${reply.answerWrterName} (${reply.answerWrter})</p> <p>작성일 : ${reply.answerRgsde}</p>
										<p data-answerCode="${reply.answerCode}">${reply.answerCn}</p><p>작성자 : ${reply.answerWrterName} (${reply.answerWrter})</p> <p>작성일 : ${reply.answerRgsde}</p>
							            <button class="replyBtn" onclick="submitCommentBtnRe(this)" value="${reply.answerCode} id="reAnswer">답글</button>
									</div>
								`;
							}
			            });
						if(v.answerUpcode == null ){
							html += `		       	
									<div class="replyForm" id="replyForm">
										<textarea placeholder="댓글을 입력하세요"></textarea>
							            <button class="submitReplyBtn" onclick="submitReplyBtn(this)" value="${v.answerCode}>등록</button>
							        </div>
							`;						
						
						}
							
						html += `	
						</div>	
						`;
					}	
				})
				
			document.getElementById("freeboardSelect").innerHTML = html;
		},
		error:function(xhr){
			alert("2")
			console.log(xhr)
		}
		
	});
}

function submitCommentBtn(){
	let empCd = document.getElementById("empCd").value;
	console.log(empCd);
	
	let commentForm = document.getElementById("commentForm");
	var textarea = commentForm.querySelector("textarea")
	var text = textarea.value
	console.log(text)
	
	let txtBox = document.querySelector(".txt-box");
	var h2Element = txtBox.querySelector("h2");
	var no = h2Element.getAttribute("data-bbscd");
	console.log(no)
		
	let jsondata = {
		"answerCode" : no,
		"answerWrter" : empCd,
		"answerCn" : text,
		"bbsNo" : no
	}
	
	$.ajax({
		type:"post",
		url:"/free/answerInsert",
		contentType: "application/json; charset=UTF-8",
		data:JSON.stringify(jsondata),
		dataType:"json",
		success:function(res){
			alert("1");
			console.log(res)
		},
		error:function(xhr){
			alert("2")
			console.log(xhr)
		}
	});
	
}

function submitCommentBtnRe(answerCode){
	document.getElementById("reAnswer").style.display="none";
	document.getElementById("replyForm").style.display="block";
	console.log(answerCode.value)

}

function submitReplyBtn(answerCode){
	let empCd = document.getElementById("empCd").value;
	console.log(empCd);
	console.log(answerCode.value)
	let commentForm = document.getElementById("replyForm");
	var textarea = commentForm.querySelector("textarea")
	var text = textarea.value
	console.log(text)
	let txtBox = document.querySelector(".txt-box");
	var h2Element = txtBox.querySelector("h2");
	var no = h2Element.getAttribute("data-bbscd");
	console.log(no)
	
	
	
	let jsondata = {
		"answerWrter":empCd,
		"answerCn" : text,
		"bbsNo" : no,
		"answerUpcode" : answerCode.value
		
	}
	console.log(jsondata)
	$.ajax({
		type:"post",
		url:"/free/replyInsert",
		contentType: "application/json; charset=UTF-8",
		data:JSON.stringify(jsondata),
		dataType:"json",
		success:function(res){
			alert("1")
			console.log(res)
		},
		error:function(xhr){
			alert("2")
			console.log(xhr)
		}
	});
}

