<%--
* [[개정이력(Modification Information)]]
* 수정일       		수정자        수정내용
* ---------- 		---------  -----------------
* 2023. 11. 30.     박민주        최초작성
* Copyright (c) 2023 by DDIT All right reserved
--%>

<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring"%>
<%@ taglib uri="http://www.springframework.org/security/tags"
	prefix="security"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>

<h1 class="mb-0">내 예약 내역</h1>
<br>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
	<div class="layout-container">
		<!-- Layout container -->
		<div class="layout-page">
			<!-- Content wrapper -->
			<div>
				<!-- Content -->
				<!-- navbar -->

				<hr />
				<div class="row mb-5">

					<!-- 등록된 차량 목록 -->
					<div class="col-md-7 col-lg-7">
						<div class="card  mb-3" style="height: 700px">
							<div class="card-body">
								<h5 class="card-title">차량 예약 내역 목록</h5>
								<hr />
								<div class="card-datatable table-responsive">
									<table class="table">
										<thead class="table-light">
											<tr>
												<th>사용날짜</th>
												<th>사용시간</th>
												<th>차량모델</th>
												<th>차량번호</th>
												<th>사용목적</th>
												<th>상태</th>
											</tr>
										</thead>
										<tbody class="table-border-bottom-0">
											<c:if test="${empty pagingV.dataList}">
												<tr>
													<td colspan="6">예약내역 없음</td>
												</tr>
											</c:if>
											<c:if test="${not empty pagingV.dataList }">
												<c:forEach items="${pagingV.dataList}" var="vhcle"
													varStatus="loopStatus">
													<tr>
														<td>${vhcle.vhcleUseDate}</td>
													
														<td>
															<c:set var="data" value="${vhcle.vhcleUseTimeCd}"/>
															<c:set var="array1" value="${fn:replace(data, 'R_V1', '09:00-13:00')} "/>
															<c:set var="array2" value="${fn:replace(array1, 'R_V2', '14:00-18:00')} "/>
															<c:out value='${array2}'/>
														</td>
														<td>${vhcle.vhcle.vhcleModel}</td>
														<td>${vhcle.vhcle.vhcleNo}</td>
														<td>${vhcle.vhcleReservePur}</td>
														<td id="vStatus"></td>
													</tr>
												</c:forEach>
											</c:if>
										</tbody>
										<tfoot>
											<tr>
												<td colspan="6">${pagingV.pagingHTML}</td>
											</tr>
										</tfoot>
									</table>
								</div>
							</div>
						</div>
					</div>

					<!-- 등록된 회의실 목록 -->
					<div class="col-md-5 col-lg-5">
						<div class="card  mb-3" style="height: 700px">
							<div class="card-body">
								<h5 class="card-title">회의실 예약 내역 목록</h5>
								<hr />
								<div class="card-datatable table-responsive">
									<table class="table">
										<thead class="table-light">
											<tr>
												<th>사용날짜</th>
												<th>사용시간</th>
												<th>회의실명</th>
												<th>상태</th>
											</tr>
										</thead>
										<tbody class="table-border-bottom-0" id="confTbody">
										</tbody>
										<tfoot id="confFooter">
										</tfoot>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- /Content -->
		</div>
		<!-- /Content wrapper -->
	</div>
	<!-- /Layout container -->
</div>

<!-- 히든태그 사용 -->
<form:form modelAttribute="simpleCondition" method="get" id="searchForm"
	class="border">
	<input type="hidden" name="page" readonly="readonly" placeholder="page" />
</form:form>

<script>

function makeTbodyConf(dataList){
	let tbodyTagConf = "";
	console.log("dataList ===> " + dataList);
	if(!dataList){
		tbodyTagConf += `
				<tr>
					<td colspan="4">예약내역 없음</td>
				</tr>
		`;
	}else{
		for(var idx=0; idx<dataList.length; idx++){
			console.log(dataList[idx]);
			tbodyTagConf += `
				<tr>
					<td>\${dataList[idx].confDate}</td>
					<td>\${dataList[idx].confTime}</td>
					<td>\${dataList[idx].confRoom.confRoomNm}</td>
					<td id="cStatus"></td>
				</tr>
			`;
		}
	}
	return tbodyTagConf;
}

function setDataListConf(pageC){
	$.ajax({
		type : "GET",
		url : `/myReservation/getDataListConf/${pageC}`,
		data: { pageC: pageC }, // Request Parameter로 데이터를 보냄
		contentType: "application/json; charset=UTF-8",
		success : function(resp){
			let pagingHTML = $(resp.paging.pagingHTML);
			let dataList = resp.paging.dataList;
			let makeTbodyConfResult = makeTbodyConf(dataList);
						
            $("#confFooter").empty();
            $("#confTbody").empty();
			
			$("#confFooter").append(pagingHTML);
			$("#confTbody").append(makeTbodyConfResult);
		},
		error : function(xhr){
			console.log("페이징 실패 ==> " + xhr);
		}
	})
}

function setDataListVhcle(){
	
}

$(function(){
	setDataListConf(1);
})

// 페이지 버튼 클릭 시 해당 페이지의 데이터 로딩
$(document).on("click", ".page-link", function(e) {
    e.preventDefault();
    let page = $(this).text();
    setDataListConf(page);
});

function fn_paging(page){
	setDataListConf(page);
}
	
</script>
<script>
	var __basePath = './';
</script>
<script
	src="https://cdn.jsdelivr.net/npm/ag-grid-community@30.2.1/dist/ag-grid-community.min.js"></script>
