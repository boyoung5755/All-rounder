/**
 * <pre>
 * 
 * </pre>
 * @author 전수진
 * @since 2023. 11. 28.
 * @version 1.0
 * <pre>
 * [[개정이력(Modification Information)]]
 * 수정일        수정자       수정내용
 * --------     --------    ----------------------
 * 2023. 11. 28.  전수진       최초작성
 * Copyright (c) 2023 by DDIT All right reserved
 * </pre>
 */ 

// 수신자 선택을 위한 리스트 출력
$(function(){
	$.getJSON("/org/list")
		.done(function(resp) {
			let empList = resp.list;
			
			console.log("empListProxy================", empList);
            let tags = makeRecpList(empList); 
			$("#prxsanctnCnfer").append(tags);
		})
		.fail(function(jqxhr, textStatus, error) {
			let err = textStatus + ", " + error;
			console.error("Request Failed: " + err);
		});
		
	// 전 직원목록을 반함
	let makeRecpList = function (respList) {
	   let tags = "";
	   
	   tags += `<option value="-1">대결자 선택</option>`;
	
	   for (let i = 0; i < respList.length; i++) {
	      if (respList[i].empName != "관리자") {
	         tags += `<option data-avatar="5.png" value="${respList[i].empCd}">[${respList[i].dept.deptName}]${respList[i].empName} ${respList[i].common.commonCodeSj}</option>`;
	      }
	   }
	   return tags;
	}
	
});

	$('#saveBtn').on("click", function(){
		let prxsanctnCnfer = $("#prxsanctnCnfer").val();
		let alwncDate = $("#alwncDate").val();
		let extshDate = $("#extshDate").val();
		let alwncReason = $("#alwncReason").val();
	
		console.log("prxsanctnCnfer 대결권수여자======="+prxsanctnCnfer);
		console.log("alwncDate 대결권시작일자======="+alwncDate);
		console.log("extshDate 대결권소멸일자======="+extshDate);
		console.log("alwncReason 대결권지정사유======="+alwncReason);
	
		let SanctionByProxyVO = {};
		SanctionByProxyVO.prxsanctnCnfer = prxsanctnCnfer;
		SanctionByProxyVO.alwncDate = alwncDate;
		SanctionByProxyVO.extshDate = extshDate;
		SanctionByProxyVO.alwncReason = alwncReason;
		
		console.log("SanctionByProxyVO======="+SanctionByProxyVO);
		console.log("SanctionByProxyVOJSON======="+JSON.stringify(SanctionByProxyVO));
	
		$.ajax({
			type:"post",
			url:"/proxy/new",
			contentType:"application/json",  // post
			data: JSON.stringify(SanctionByProxyVO) ,
			dataType:"text",
			success:function(rslt){
				// JSON.parse(rslt)  jQuery가 몰래해줌
				console.log("서버에서 온 값:", rslt);
	
				if(rslt == "OK"){
					Swal.fire({
						icon: "success",
						title: "대결권 등록완료!",
						text: "대결권 등록이 완료 되었습니다",
						showConfirmButton: false,
						timer: 1500
					});
					$(".swal2-container.swal2-center.swal2-backdrop-show").css("z-index",3000); 
				

				} else if(rslt == "PKDUPLICATED") {
					Swal.fire({
						icon: "error",
						title: "대결권 등록실패!",
						text: "이미 대결권자로 등록된 직원입니다.",
						showConfirmButton: false,
						timer: 1500
					});
					$(".swal2-container.swal2-center.swal2-backdrop-show").css("z-index",3000);   // default 1060, 동적생성이라 맹글고 바꿔야 함!
					
				} else {
					Swal.fire({
						icon: "error",
						title: "대결권 등록실패!",
						text: "대결권 등록에 실패 하였습니다",
						showConfirmButton: false,
						timer: 1500
					});
					$(".swal2-container.swal2-center.swal2-backdrop-show").css("z-index",3000);   // default 1060, 동적생성이라 맹글고 바꿔야 함!
					
				}
			},
		    error: function (request, status, error) {
		        console.log("code: " + request.status)
		        console.log("message: " + request.responseText)
		        console.log("error: " + error);
		    }
		});
	});
