/**
 * 
 */

const columnDefs = [
	{ field: "vhcleCd", headerName: "차량 코드" },
	{ field: "vhcleNo", headerName: "차량 번호" ,editable: true},
	{ field: "vhcleModel", headerName: "차량 모델", editable: true },
	{ field: "vhcleFlag", headerName: "차량 상태", editable: true},
	{ field: "vhcleCapacity", headerName: "수용인원(명)", editable: true},
	{ field: "vhcleRegistDate", headerName: "등록일자" },
	// { field: "vhcleImgUrl", headerName:"모델"},
];

// 데이타 정의
const rowData = []; //초기값

// 설정 옵션: 중요, 위에 정의한 것들이 여기서 통합됨에 주목
const gridOptions = {
	columnDefs: columnDefs,
	rowData: rowData,
	defaultColDef: {
		flex: 1,       // 자동으로 같은 사이즈롱
		filter: true,
		resizable: true,
		minWidth: 100,
		headerClass: "centered"
	},
	pagination: true, //페이지설정
	paginationAutoPageSize: true,
	paginationPageSize: 5,
	localText:{noRowsToShow: '조회 결과가 없습니다.'}, //데이터가 없는 경우 보여 주는 사용자 메시지
	suppressMovableColumns:"true",//헤더고정
	onCellEditingStarted: event => {
		console.log(event);
		console.log("편집시작!");
	},
	onCellEditingStopped: event => {
        console.log('cellEditingStopped' + event)
    }
};

const getData = () => {
	var xhr = new XMLHttpRequest(); //비동기 통신을 담당하는 자바스크립트 객체
	xhr.open("GET", "/vehicle", true); //요청 초기화
	xhr.onreadystatechange = function () {
		if (xhr.readyState == 4 && xhr.status == 200) { //수신완료&&통신성공
			let result = JSON.parse(xhr.responseText);
			for(var i = 0; i < result.length; i++) {
				var vhcleFlag = result[i].vhcleFlag;
				var vhcleFlagText = null;
				switch(vhcleFlag) {
					case "0":
						vhcleFlagText = "사용가능"
						console.log("사용가능");
						break;
					case "1":
						vhcleFlagText = "사용중"
						console.log("사용중");
						break;
					case "2":
						vhcleFlagText = "예약중"
						console.log("예약중");
						break;
					default : 
						vhcleFlagText = "사용중지"
						console.log("예약중");
				}
				result[i].vhcleFlag = vhcleFlagText;
			}
			gridOptions.api.setRowData(result);
		}
	};
	xhr.send();
}

/*
function fSerialize(myForm){
	console.log("form ==> ", myForm);

	let sendData = [];
	let elems = myForm.elements;
	for(var elem of elems){
		console.log("element ==> ", elem.value);
		sendData[elem.name] = elem.value;
	}
	console.log("sendData ==> ", sendData);
}
*/

//차량 등록 모달에서 save 클릭 시 발생하는 이벤트 함수
function fn_jobInsert(){
	// fSerialize(senderForm);
	
	/*
	*/
	
	var vhcleImgUrlFile = document.querySelector("#vhcleImgUrlFile").files[0];

	const vehicleVO = {};
	var vhcleModel = document.querySelector("#vhcleModel").value;
	var vhcleNo = document.querySelector("#vhcleNo").value;
	var vhcleCapacity = document.querySelector("#vhcleCapacity").value;

	vehicleVO.vhcleModel = vhcleModel;
	vehicleVO.vhcleNo = vhcleNo;
	vehicleVO.vhcleCapacity = vhcleCapacity;

	console.log("vehicleVO ==> " , vehicleVO);
	console.log("JSON.stringify(vehicleVO) ==> " , JSON.stringify(vehicleVO));

	const formData = new FormData();
	formData.append('file',vhcleImgUrlFile);
	formData.append('vehicleVO', new Blob([JSON.stringify(vehicleVO)], {type:'application/json;charset=utf-8'}));

	var xhr = new XMLHttpRequest();
	xhr.open("POST","/vehicle", true);
	xhr.setRequestHeader(CSRFHEADERNAME, CSRFTOKEN);
	xhr.onreadystatechange = function(){
		if(xhr.readyState==4 && xhr.status==200){
			console.log(xhr.responseText);
		}
	};
	xhr.send(formData);
}


$(function () {
	var vehicleList = document.querySelector("#vehicleList");
	new agGrid.Grid(vehicleList, gridOptions);
	getData();  // 데이터 불러오깅
});