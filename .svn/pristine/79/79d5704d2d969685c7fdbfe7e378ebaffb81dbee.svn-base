<%--
* [[개정이력(Modification Information)]]
* 수정일       	수정자        수정내용
* ----------  	---------  -----------------
* 2023. 11. 21. 김보영        최초작성
* Copyright (c) 2023 by DDIT All right reserved
 --%>

<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form" %>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security" %>        


 
<h1 class="mb-0">${proInfo.proNm}</h1><br>

<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
  <div class="layout-container">
    <!-- Layout container -->
    <div class="layout-page">
      <!-- Content wrapper -->
      <div>
        <!-- Content -->
        <!-- navbar -->
        <div class="col-md-7 col-lg-7">
          <ul class="nav nav-pills mb-3 nav-fill" role="tablist">
            <li class="nav-item" role="presentation">
              <a class="nav-link dropdown-toggle" href="javascript:void(0);" data-bs-toggle="dropdown"
                aria-expanded="false" data-trigger="hover">
                <i class='bx bxs-copy-alt'></i>
                　프로젝트</a>
              <div class="dropdown-menu">
                <c:forEach items="${proj}" var="proj">
                  <c:if test="${proj.proSttus == 1}">
                    <a class="dropdown-item" href="#">${proj.proNm}</a>
                  </c:if>
                </c:forEach>
              </div>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-item nav-link active" href="/job/${proSn}/home">
                <i class='bx bx-edit'></i>
                　일감목록</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-item nav-link" href="javascript:void(0)">
                <i class='bx bx-calendar-exclamation'></i>
                　이슈</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-item nav-link" href="/pms/gantt/${proSn}">
                <i class='bx bx-chart'></i>
                　간트차트</a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-item nav-link disabled" href="javascript:void(0)">
                <i class='bx bxs-doughnut-chart'></i>
                　리더통계</a>
            </li>
          </ul>
        </div>
        <!-- /navbar -->
        <!-- 내용 -->

        <div class="row">
          <div class="col-xl-6 col-lg-5 col-md-5">
            <!-- About User -->
            <div class="card mb-4">
              <div class="card-body">
                <small class="text-muted text-uppercase">상세정보</small>
                <ul class="list-unstyled mb-4 mt-3">
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-user"></i><span class="fw-medium mx-2">일감순번 :</span> <span>${detail.jobSn}</span>
                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-check"></i><span class="fw-medium mx-2">일감명 :</span> <span>${detail.jobSj}</span>
                  </li>
                  <li>
                    <div class="row g-2" style="text-align: center;">
                      <div class="col mb-3">
			            <button type="button"
			              class="btn-jobStcd btn rounded-pill btn-label-success <c:if test="${detail.jobStcd eq '1'}">active</c:if>">요청</button>
			          </div>
			          <div class="col mb-3">
			            <button  type="button"
			              class="btn-jobStcd btn rounded-pill btn-label-primary <c:if test="${detail.jobStcd eq '2'}">active</c:if>">진행</button>
			          </div>
			          <div class="col mb-3">
			            <button  type="button"
			              class="btn-jobStcd btn rounded-pill btn-label-danger <c:if test="${detail.jobStcd eq '3'}">active</c:if>">피드백</button>
			          </div>
			          <div class="col mb-3">
			            <button  type="button"
			              class="btn-jobStcd btn rounded-pill btn-label-warning <c:if test="${detail.jobStcd eq '4'}">active</c:if>">보류</button>
			          </div>
			          <div class="col mb-3">
			            <button  type="button"
			              class="btn-jobStcd btn rounded-pill btn-label-info <c:if test="${detail.jobStcd eq '5'}">active</c:if>">완료</button>
			          </div>
                    </div>

                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-star"></i><span class="fw-medium mx-2">작성자 :</span> <span>${detail.findName}</span>
                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-flag"></i><span class="fw-medium mx-2">작성일 :</span> <span>${detail.jobRdate}</span>
                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-detail"></i><span class="fw-medium mx-2">시작일 :</span>
                    <span>${detail.jobBdate}</span>
                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-detail"></i><span class="fw-medium mx-2">종료일 :</span>
                    <span>${detail.jobEdate}</span>
                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-detail"></i><span class="fw-medium mx-2">우선순위 :</span>
                    <c:if test="${detail.jobPriort eq 1 }">
                   	 <span>긴급</span>
                    </c:if>
                    <c:if test="${detail.jobPriort eq 2 }">
                   	 <span>높음</span>
                    </c:if>
                    <c:if test="${detail.jobPriort eq 3 }">
                   	 <span>보통</span>
                    </c:if>
                    <c:if test="${detail.jobPriort eq 4 }">
                   	 <span>낮음</span>
                    </c:if>
                  </li>
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-detail"></i><span class="fw-medium mx-2">진행도 :</span>
                  </li>
                  <li>
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" role="progressbar"
                        style="width: ${detail.jobProgrs}%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </li>
                </ul>
                <c:if test="${empty detail.jobuSn}">
	                <!-- 상위일감일때  -->
	                <small class="text-muted text-uppercase">하위일감</small>
	                <ul>
	                	<c:forEach items="${LowJList }" var="row">
		                  <li class="d-flex align-items-center mb-3">
		                   <a href='/job/${detail.proSn}/${row.jobSn}/detail'><i class="bx bx-detail"></i><span class="fw-medium mx-2">${row.jobSj }</span></a>
		                  </li>
	                	</c:forEach>
	                </ul>
                </c:if>
                
                <!-- 담당자 리스트 -->

                <small class="text-muted text-uppercase mb-3">담당자</small>
                <ul class="list-unstyled mb-0 mt-2">
                  <li class="d-flex align-items-center ">
                    <!-- 담당자 정보 표시  -->
                    <c:if test="${not empty chargerList}">
                    	<div> 
		                    <div class="d-flex align-items-center avatar-group">
		                    <c:forEach items="${chargerList}" var="charger" varStatus="i" >
		                    	<c:if test="${not empty charger.emp.empProfileImg}">
                              <div class="avatar pull-up" data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" aria-label="Vinnie Mostowy" data-bs-original-title="${charger.emp.empName}">
                                <img src="${charger.emp.empProfileImg}" alt="Avatar" class="rounded-circle">
                              </div>
		                    	
		                    	</c:if>
		                    	<c:if test="${empty charger.emp.empProfileImg}">
                              <div class="avatar pull-up" data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" aria-label="Vinnie Mostowy" data-bs-original-title="${charger.emp.empName}">
                                <img src='/resources/images/basic.png' alt="Avatar" class="rounded-circle">
                              </div>
		                    	
		                    	</c:if>
		                    	
                              
	                    	</c:forEach>
                            </div>
	                    </div>
                    </c:if>
                  </li>
                </ul>
                <!-- /담당자 리스트 -->
                
              </div>
            </div>
            <!--/ About User -->
            <!-- 파일 내역 -->
            <div class="card mb-4">
              <div class="card-body">
                <small class="text-muted text-uppercase">파일내역</small>
                <ul class="list-unstyled mt-3 mb-0">
                  <li class="d-flex align-items-center mb-3">
                    <i class="bx bx-check"></i><span class="fw-medium mx-2">파일이름</span>
                    <span>13.5k</span>
                  </li>
                </ul>
              </div>
            </div>
            <!--/ 파일 내역 -->
          <!-- 수정폼버튼 -->
            <button type="button" class="btn btn-label-primary mb-3" style="width: 100%;" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBoth" aria-controls="offcanvasBoth">
              <span class="tf-icons bx bx-pie-chart-alt me-1"></span>일감 수정하기
            </button>
            <!-- /수정폼버튼 -->
          </div>
          <div class="col-xl-6 col-lg-7 col-md-7">
          	 <!-- 내용 -->
            <div class="card card-action mb-4">
              <div class="card-header align-items-center">
                <h5 class="card-action-title mb-0"><i class="bx bx-list-ul me-2"></i>내용</h5>
              </div>
              <div class="card-body">
              <!-- 일감내용부분 -->
              ${detail.jobCn}
              </div>
            </div>
            <!--/ 내용 -->
            <!-- Activity Timeline -->
            <div class="card card-action mb-4">
              <div class="card-header align-items-center">
                <h5 class="card-action-title mb-0"><i class="bx bx-list-ul me-2"></i>Activity Timeline</h5>
                <div class="card-action-element">
                  <div class="dropdown">
                    <button type="button" class="btn dropdown-toggle hide-arrow p-0" data-bs-toggle="dropdown"
                      aria-expanded="false">
                      <i class="bx bx-dots-vertical-rounded"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                      <li><a class="dropdown-item" href="javascript:void(0);">Share timeline</a></li>
                      <li><a class="dropdown-item" href="javascript:void(0);">Suggest edits</a></li>
                      <li>
                        <hr class="dropdown-divider">
                      </li>
                      <li><a class="dropdown-item" href="javascript:void(0);">Report bug</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <ul class="timeline ms-2">
                  <li class="timeline-item timeline-item-transparent">
                    <span class="timeline-point-wrapper"><span
                        class="timeline-point timeline-point-warning"></span></span>
                    <div class="timeline-event">
                      <div class="timeline-header mb-1">
                        <h6 class="mb-0">Client Meeting</h6>
                        <small class="text-muted">Today</small>
                      </div>
                      <p class="mb-2">Project meeting with john @10:15am</p>
                      <div class="d-flex flex-wrap">
                        <div class="avatar me-3">
                          <img src="../../assets/img/avatars/3.png" alt="Avatar" class="rounded-circle">
                        </div>
                        <div>
                          <h6 class="mb-0">Lester McCarthy (Client)</h6>
                          <span>CEO of Infibeam</span>
                        </div>
                      </div>
                    </div>
                  </li>
                  <li class="timeline-item timeline-item-transparent">
                    <span class="timeline-point-wrapper"><span class="timeline-point timeline-point-info"></span></span>
                    <div class="timeline-event">
                      <div class="timeline-header mb-1">
                        <h6 class="mb-0">Create a new project for client</h6>
                        <small class="text-muted">2 Day Ago</small>
                      </div>
                      <p class="mb-0">Add files to new design folder</p>
                    </div>
                  </li>
                  <li class="timeline-item timeline-item-transparent">
                    <span class="timeline-point-wrapper"><span
                        class="timeline-point timeline-point-primary"></span></span>
                    <div class="timeline-event">
                      <div class="timeline-header mb-1">
                        <h6 class="mb-0">Shared 2 New Project Files</h6>
                        <small class="text-muted">6 Day Ago</small>
                      </div>
                      <p class="mb-2">
                        Sent by Mollie Dixon
                        <img src="../../assets/img/avatars/4.png" class="rounded-circle ms-3" alt="avatar" height="20"
                          width="20">
                      </p>
                      <div class="d-flex flex-wrap gap-2">
                        <a href="javascript:void(0)" class="me-3">
                          <img src="../../assets/img/icons/misc/pdf.png" alt="Document image" width="20" class="me-2">
                          <span class="h6">App Guidelines</span>
                        </a>
                        <a href="javascript:void(0)">
                          <img src="../../assets/img/icons/misc/doc.png" alt="Excel image" width="20" class="me-2">
                          <span class="h6">Testing Results</span>
                        </a>
                      </div>
                    </div>
                  </li>
                  <li class="timeline-item timeline-item-transparent">
                    <span class="timeline-point-wrapper"><span
                        class="timeline-point timeline-point-success"></span></span>
                    <div class="timeline-event pb-0">
                      <div class="timeline-header mb-1">
                        <h6 class="mb-0">Project status updated</h6>
                        <small class="text-muted">10 Day Ago</small>
                      </div>
                      <p class="mb-0">Woocommerce iOS App Completed</p>
                    </div>
                  </li>
                  <li class="timeline-end-indicator">
                    <i class="bx bx-check-circle"></i>
                  </li>
                </ul>
              </div>
            </div>
            <!--/ Activity Timeline -->
           

            

            <!-- 일감삭제 -->
            <div class="card">
              <h5 class="card-header">일감 삭제</h5>
              <div class="card-body">
                <div class="mb-3 col-12 mb-0">
                  <div class="alert alert-warning">
                    <h6 class="alert-heading fw-medium mb-1">정말로 일감을 삭제하시겠습니까?</h6>
                    <p class="mb-0">일감을 삭제하면 되돌릴 수 없습니다.</p>
                  </div>
                </div>
                <form id="formAccountDeactivation">
                  <security:csrfInput />
                  <input type="hidden" name="empCd" value='<c:out value="${emp.empCd}"/>' />
                  <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="accountActivation" id="accountActivation">
                    <label class="form-check-label" for="accountActivation">확인했습니다.</label>
                  </div>
                  <button type="button" onclick="fn_deleteEmp()" class="btn btn-danger">삭제</button>
                </form>
              </div>
            </div>
            <!-- /일감삭제 -->
          </div>
        </div>
        <!-- /내용 -->
      </div>
      <!-- /Content -->
    </div>
    <!-- /Content wrapper -->
  </div>
  <!-- /Layout container -->
</div>
<!-- /Layout wrapper -->



<!-- 오프캔버스-수정 -->

<div class="offcanvas offcanvas-end " data-bs-scroll="true" tabindex="-1" id="offcanvasBoth"
  aria-labelledby="offcanvasBothLabel" aria-modal="true" role="dialog" style="width: 600px;">
  <div class="offcanvas-header">
    <h5 id="offcanvasBothLabel" class="offcanvas-title">
      <font style="vertical-align: inherit;">
        <font style="vertical-align: inherit;">수정</font>
      </font>
    </h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="닫다"></button>
  </div>
  <div class="offcanvas-body my-auto mx-0 flex-grow-0">
    <!--내용-->
    <form>
      <div class="card-body">
        <div class="mb-3 row">
          <label for="html5-search-input" class="col-md-2 col-form-label">일감명</label>
          <div class="col-md-10">
            <input class="form-control" type="search" value="${detail.jobSj}" name="jobSj" id="html5-search-input">
          </div>
        </div>
        <div class="mb-3 row">
          <label for="html5-date-input" class="col-md-2 col-form-label">시작일</label>
          <div class="col-md-10">
            <input class="form-control" type="date" value="${detail.jobBdate}" name="jobBdate" id="html5-date-input">
          </div>
        </div>
        <div class="mb-3 row">
          <label for="html5-date-input" class="col-md-2 col-form-label">종료일</label>
          <div class="col-md-10">
            <input class="form-control" type="date" value="${detail.jobEdate}" name="jobEdate" id="html5-date-input">
          </div>
        </div>
        <div class="row g-2" style="text-align: center;">
          <input id="jobStcd" type="hidden" name="jobStcd" value="${detail.jobStcd}" />
          <div class="col mb-3">
            <button onclick="fn_jobStcd('1')" type="button"
              class="btn-jobStcd btn rounded-pill btn-label-success <c:if test="${detail.jobStcd eq '1'}">active</c:if>">요청</button>
          </div>
          <div class="col mb-3">
            <button onclick="fn_jobStcd('2')" type="button"
              class="btn-jobStcd btn rounded-pill btn-label-primary <c:if test="${detail.jobStcd eq '2'}">active</c:if>">진행</button>
          </div>
          <div class="col mb-3">
            <button onclick="fn_jobStcd('3')" type="button"
              class="btn-jobStcd btn rounded-pill btn-label-danger <c:if test="${detail.jobStcd eq '3'}">active</c:if>">피드백</button>
          </div>
          <div class="col mb-3">
            <button onclick="fn_jobStcd('4')" type="button"
              class="btn-jobStcd btn rounded-pill btn-label-warning <c:if test="${detail.jobStcd eq '4'}">active</c:if>">보류</button>
          </div>
          <div class="col mb-3">
            <button onclick="fn_jobStcd('5')" type="button"
              class="btn-jobStcd btn rounded-pill btn-label-info <c:if test="${detail.jobStcd eq '5'}">active</c:if>">완료</button>
          </div>
        </div>
        <div class="row g-2">
          <div class="col mb-3">
            <label for="nameBackdrop" class="fw-medium"><i class="bx bx-objects-horizontal-left bx-sm mb-1"></i>
              진행도</label>
            <select name ="jobProgrs" class="form-select" tabindex="0" id="roleEx4">
                <c:forEach begin="0" end="100" step="10" var="percentage" varStatus="loop">
                  <option value="${detail.jobProgrs}">${percentage}%</option>
                </c:forEach>
            </select>
          </div>
          <div class="col mb-3">
            <label for="nameBackdrop" class="fw-medium"><i class="bx bx-error-circle bx-sm mb-1"></i> 우선순위</label>
            <select name="jobPriort" class="form-select" tabindex="0" id="">
              <option value="1">긴급</option>
              <option value="2">높음</option>
              <option value="3" selected>보통</option>
              <option value="4">낮음</option>
            </select>
            <input type="hidden" value="${detail.proSn}" name="proSn">
            <input type="hidden" value="${detail.jobSn}" name="jobSn">
          </div>
        </div>
        <div class="row g-2">
          <div class="col mb-3">
            <label for="nameBackdrop" class="fw-medium d-block"><i class='bx bx-universal-access bx-sm mb-1'></i>
              담당자</label>
            <c:if test="${not empty proM }">
              <c:forEach items="${proM}" var="proM" varStatus="i">
                <div class=" col mx-2 form-check custom-option custom-option-basic mb-3 checked d-inline-block">
                  <label class="form-check-label custom-option-content" for="proM${i.index }">
                  
                    <input class="form-check-input" type="checkbox" id="proM${i.index }" name="tempEmpCd"
                      value="${proM.emp.empCd}">
                    <span class="custom-option-header pb-0">
                      <span class="fw-medium">${proM.emp.empName}</span>
                    </span>
                  </label>
                </div>
              </c:forEach>
            </c:if>
          </div>
        </div>
        <div class="mb-3 row">
          <label for="html5-tel-input" class="col-md-2 col-form-label">내용</label>
          <div class="col-md-10">
            <textarea name="jobCn"  rows="5" cols="20" id="document-Status" class="form-control">${detail.jobCn}</textarea>
          </div>
        </div>
        <div class="row g-2">
          <div class="col mb-3">
            <label for="dobBackdrop" class="fw-medium"><i class='bx bx-file-find bx-sm mb-1'></i> 첨부파일</label>
            <input type="file" class="form-control" id="insertJobFiles" name="jobFile" multiple />
            <div id="fileList"></div>
          </div>
        </div>

        <div class="btn-group" role="group" aria-label="Basic example">
          <button type="button" onclick="fn_jobUpdate()" class="btn btn-label-primary">수정</button>
          <button type="button" onclick="fn_cancle()" class="btn btn-label-info">닫기</button>
        </div>
      </div>
    </form>
    <!--/내용-->
  </div>
</div>





<script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/app/job/job.js"></script>







