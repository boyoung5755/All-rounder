<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  [[개정이력(Modification Information)]]       -->
<!--  수정일        수정자     수정내용               -->
<!--  ==========   ======    ==============        -->
<!--  2023. 11. 30.  오경석     최초작성               -->
<!--  Copyright (c) 2023 by DDIT All right reserved -->
<mapper namespace="kr.or.ddit.groupware.board.freeboard.dao.FreeBoardDAO">
	
	<resultMap type="BoardVO" id="boardMap" autoMapping="true">
		<id property="bbsNo" column="BBS_NO"/>
		<result property="bbsNo" column="BBS_NO"/>
		<collection property="boardFileList" ofType="BoardFileVO" autoMapping="true" />
	</resultMap>
	
	<!-- 페이징을 위한 총 레코드 수 조회 -->
	<select id="selectTotalFree" parameterType="PaginationInfo" resultType="int">
		SELECT COUNT(*) 
		FROM BBS 
		WHERE 
			BBS_CATEGORY='F'
			<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord) and simpleCondition.searchType eq 'title'">
				AND	INSTR(BBS_SJ, #{simpleCondition.searchWord}) > 0
			</if>	
	</select>
	
		<!-- 페이징을 위한 공지사항 리스트 조회 -->
	<select id="selectFreeBoardList" parameterType="PaginationInfo" resultMap="boardMap">
		SELECT BOARDVIEW.* 
			FROM ( SELECT A.*, ROWNUM RNUM
			    FROM(
			        SELECT
			            A.BBS_NO							/* 게시판번호 */
			            , A.BBS_SJ							/* 게시판제목 */
			            , A.BBS_CN							/* 게시판내용 */
			            , A.BBS_RGSDE					/* 등록일자 */
			            , A.EMP_CD						/* 작성자 */
			            , A.BBS_RDCNT			/* 조회수 */
			            , A.BBS_CATEGORY			/* 게시판 카테고리 */
			            , B.FILE_CODE		/* 첨부파일코드 */
			            , B.FILE_NAME		/* 파일이름 */
			            , B.FILE_SAVENAME	/* 파일저장이름 */
			            , B.FILE_MIME		/* 파일타입 */
			            , B.FILE_SIZE		/* 파일크기 */
			            , B.FILE_FANCYSIZE	/* 파일팬시크기 */
			            , FN_GET_EMP_NAME(A.EMP_CD) EMP_NAME /*작성자 이름*/
			        FROM
			            BBS A LEFT OUTER JOIN BBS_FILE B ON(A.BBS_NO = B.BBS_NO)
			        WHERE
			            A.BBS_CATEGORY='F'  
			        <if test="@org.apache.commons.lang3.StringUtils@isNotBlank(simpleCondition.searchWord) and simpleCondition.searchType eq 'title'">
						AND	INSTR(BBS_SJ, #{simpleCondition.searchWord}) > 0
					</if>	
			        ORDER BY A.BBS_RGSDE DESC -- 최근 등록일자 기준으로 정렬
			    ) A)  BOARDVIEW
			<![CDATA[ 
			WHERE RNUM >= #{startRow} AND RNUM <= #{endRow}
			]]> 
	</select>
	
	<resultMap type="BoardVO" id="freeMap" autoMapping="true">
		<id property="bbsNo" column="BBS_NO"/>
		<result property="bbsNo" column="BBS_NO"/>
		<collection property="boardFileList" ofType="BoardFileVO" autoMapping="true" />
		<collection property="anserList" ofType="AnswerVO" autoMapping="true" />
	</resultMap>
	
	<select id="selectFreeBoard" parameterType="int" resultMap="freeMap"> 
		SELECT
		    A.BBS_NO							
		    , A.BBS_SJ							
		    , A.BBS_CN						
		    , A.BBS_RGSDE					
		    , A.EMP_CD						
		    , A.BBS_RDCNT			
		    , A.BBS_CATEGORY			
		    , B.FILE_CODE		
		    , B.FILE_NAME		
		    , B.FILE_SAVENAME	
		    , B.FILE_MIME		
		    , B.FILE_SIZE		
		    , B.FILE_FANCYSIZE	
		    , FN_GET_EMP_NAME(A.EMP_CD) EMP_NAME 
		    , C.ANSWER_CODE
		    , C.ANSWER_WRTER
		    , C.ANSWER_RGSDE
		    , C.ANSWER_CN
		    , (SELECT EMP_NAME FROM EMPLOYEE E, ANSWER A WHERE E.EMP_CD = A.ANSWER_WRTER) ANSWERWRTERNAME
		FROM
		    BBS A
		    LEFT OUTER JOIN BBS_FILE B ON (A.BBS_NO = B.BBS_NO)
		    LEFT OUTER JOIN ANSWER C ON (A.BBS_NO = C.BBS_NO)  
		WHERE
		    A.BBS_CATEGORY='F' AND A.BBS_NO=#{bbsNo}
	</select>
	
</mapper>