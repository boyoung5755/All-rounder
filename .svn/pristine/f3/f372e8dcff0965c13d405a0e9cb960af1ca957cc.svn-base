/**
 * <pre>
 * 
 * </pre>
 * @author 작성자명
 * @since 2023. 11. 23.
 * @version 1.0
 * <pre>
 * [[개정이력(Modification Information)]]
 * 수정일        	수정자       수정내용
 * --------     	--------    ----------------------
 * 2023. 11. 23.     김보영       최초작성 ,이슈등록
 * Copyright (c) 2023 by DDIT All right reserved
 * </pre>
 */ 

//일반인지 결함인지 버튼클릭이벤트
function fn_issueSe(issueSe){
		
	document.getElementById("issueSe").value = issueSe;
		
	var elements = document.querySelectorAll('.btn-issueSe');
	elements.forEach(function(element) {
		element.classList.remove('active');
	});
	    
	    //제이쿼리 사용법
// 	    $(".btn-jobStcd").each(function(i, ele){
// 	    $.each(".btn-jobStcd", function(i, ele){
// 	    	$(ele).removeClass("active");
// 	    })
	    
	$(".btn-issueSe").eq(issueSe-1).addClass("active");
	//$("#jobStcd").val(jobStcd);
}



//이슈등록 비동기

function fn_issueInsert(){
	
	fn_swalConfirm("이슈를 등록하시겠습니까?", function(){
		//비동기
		var data = new FormData($("#issueInsertForm")[0]);
		var proSn = $('#proSn').val();
	
		$.ajax({
			type: "POST",
			enctype: 'multipart/form-data',
			url: "/issue/"+proSn+"/insert",
			data: data,
			processData: false,
			contentType: false,
			cache: false,
			success: function (data) {
				var text;
				var icon;
				if (data.success == "Y") {
					text = "이슈 등록이 완료되었습니다.";
					icon = "success";
				} else {
					text = "이슈 등록이 실패되었습니다.";
					icon = "warning";
				}
				//모달창열기
				fn_swalComplete(text, icon, "/issue/"+proSn+"/home", data.success);
			},
			error: function () {
				fn_swalError();
			}
		});
	});
	
}


//이슈 목록 조회

$(function () {

	fn_inProgressIssue();
	fn_onHoldIssue();
	fn_completedIssue();

});

//진행 이슈 조회
function fn_inProgressIssue(){
	
	var proSn = $('#proSn').val();
	var issueSttus = '1'; 
	
	let settings ={
		url : '/issue/'+ proSn +'/'+issueSttus+'/list' ,
		contentType: 'application/json',
		method: "get",
		dataType: "json"
	};
	
	let tag ="";
	
	$.ajax(settings)
		.done(function (resp){
		
			let issueList = resp.issueList ;
			if(issueList[0] != null){
				$.each(issueList , function(i,v){
					if(v.issueNo != null){
						tag +=`
							<div class="card shadow-none bg-transparent border border-primary mb-3">
								<div class="card-body">
									<h5 class="card-title">${v.issueSj}</h5>
									<p class="card-text">${v.issueCn}</p>
								</div>
							</div>
						`;	
					}else{
						tag +=`
							<div class="card shadow-none bg-transparent border border-primary mb-3">
								<div class="card-body">
									<h5 class="card-title">없음</h5>
									<p class="card-text">진행 이슈가 존재하지 않습니다.</p>
								</div>
							</div>
						`; 
					}
					$('#inProgressIssue').html(tag);
				});
			}
		});
}


//보류 이슈 조회
function fn_onHoldIssue(){
	
	var proSn = $('#proSn').val();
	var issueSttus = '2'; 
	
	let settings ={
		url : '/issue/'+ proSn +'/'+issueSttus+'/list' ,
		contentType: 'application/json',
		method: "get",
		dataType: "json"
	};
	
	let tag ="";
	
	$.ajax(settings)
		.done(function (resp){
		
			let issueList = resp.issueList ;
			if(issueList[0] != null){
				$.each(issueList , function(i,v){
					if(v.issueNo != null){
						tag +=`
							<div class="card shadow-none bg-transparent border border-warning mb-3">
								<div class="card-body">
									<h5 class="card-title">${v.issueSj}</h5>
									<p class="card-text">${v.issueCn}</p>
								</div>
							</div>
						`;	
					}else{
						tag +=`
							<div class="card shadow-none bg-transparent border border-warning mb-3">
								<div class="card-body">
									<h5 class="card-title">없음</h5>
									<p class="card-text">보류 이슈가 존재하지 않습니다.</p>
								</div>
							</div>
						`;
					}
					$('#onHoldIssue').html(tag);
				});
			}
		});
}



//완료 이슈 조회
function fn_completedIssue(){
	
	var proSn = $('#proSn').val();
	var issueSttus = '3'; 
	
	let settings ={
		url : '/issue/'+ proSn +'/'+issueSttus+'/list' ,
		contentType: 'application/json',
		method: "get",
		dataType: "json"
	};
	
	let tag ="";
	
	$.ajax(settings)
		.done(function (resp){
		
			let issueList = resp.issueList ;
			if(issueList[0] != null){
				$.each(issueList , function(i,v){
					if(v.issueNo != null){
						tag +=`
							<div class="card shadow-none bg-transparent border border-success mb-3">
								<div class="card-body">
									<h5 class="card-title">${v.issueSj}</h5>
									<p class="card-text">${v.issueCn}</p>
								</div>
							</div>
						`;	
					}else{
						tag +=`
							<div class="card shadow-none bg-transparent border border-success mb-3">
								<div class="card-body">
									<h5 class="card-title">없음</h5>
									<p class="card-text">완료 이슈가 존재하지 않습니다.</p>
								</div>
							</div>
						`;
					}
					$('#completedIssue').html(tag);
				});
			}
		});
};

