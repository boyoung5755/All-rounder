/**
 * <pre>
 * 
 * </pre>
 * @author 박민주
 * @since 2023. 11. 28.
 * @version 1.0
 * <pre>
 * [[개정이력(Modification Information)]]
 * 수정일        수정자       수정내용
 * --------     --------    ----------------------
 * 2023. 11. 28.  박민주       최초작성 
 * Copyright (c) 2023 by DDIT All right reserved
 * </pre>
 */

const columnDefsConf = [
	{ checkboxSelection: true, headerCheckboxSelection: true },
	{ field: "confRoomCd", headerName: "회의실 코드", sortable: true },
	{ field: "confRoomNm", headerName: "회의실 이름", editable: true, sortable: true },
	{ field: "confRoomCapacity", headerName: "회의실 수용인원", editable: true },
	{ field: "confYn", headerName: "회의실 사용가능 상태 여부", editable: true },
	// { field: "vhcleImgUrl", headerName:"모델"},
];

const rowDataConf = []; //초기값

// 설정 옵션: 중요, 위에 정의한 것들이 여기서 통합됨에 주목
const gridOptionsConf = {
	columnDefs: columnDefsConf,
	rowSelection: 'multiple',
	rowData: rowData,
	defaultColDef: {
		flex: 1,       // 자동으로 같은 사이즈롱
		filter: true,
		resizable: true,
		minWidth: 100,
		headerClass: "centered"
	},
	pagination: true, //페이지설정
	paginationAutoPageSize: true,
	paginationPageSize: 5,
	localText: { noRowsToShow: '조회 결과가 없습니다.' }, //데이터가 없는 경우 보여 주는 사용자 메시지
	suppressMovableColumns: "true",//헤더고정
	onCellEditingStarted: event => {
		console.log(event);
		console.log("편집시작!");
	},
	onCellEditingStopped: event => {
		if (event.newValue !== event.oldValue) { //새로운 데이터 입력시 update 함수 실행
			updateData(event);
		}
	}
};

const getDataConf = () => {
	var xhr = new XMLHttpRequest(); //비동기 통신을 담당하는 자바스크립트 객체
	xhr.open("GET", "/adConfRoom", true); //요청 초기화
	xhr.onreadystatechange = function () {
		if (xhr.readyState == 4 && xhr.status == 200) { //수신완료&&통신성공
			let result = JSON.parse(xhr.responseText);
			console.log(result.confRoomList);
			for(var i = 0; i < result.confRoomList.length; i++) {
				if(result.confRoomList[i].confYn == "Y"){
					result.confRoomList[i].confYn = "사용가능";
				}else{
					result.confRoomList[i].confYn = "사용불가";
				}
				gridOptionsConf.api.setRowData(result.confRoomList);
			}
		}
	};
	xhr.send();
}

$(function () {
	var confRoomList = document.querySelector("#confRoomList");
	new agGrid.Grid(confRoomList, gridOptionsConf);
	getDataConf();  // 데이터 불러오깅

});