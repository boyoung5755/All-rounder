<%--
* [[개정이력(Modification Information)]]
* 수정일                 수정자      수정내용
* ----------  ---------  -----------------
* Nov 22, 2023      송석원      최초작성
* Copyright (c) 2023 by DDIT All right reserved
 --%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form" %>
<%@ taglib uri="http://www.springframework.org/tags" prefix="spring" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="security" %>    

<div class="card">
	<div class="card-header border-bottom">
		<h4 class="card-title">프로젝트 관리</h4>
		<div class="d-flex justify-content-between align-items-center row py-3 gap-3 gap-md-0">
			<div class="col-md-4 user_role"></div>
			<div class="col-md-4 user_plan"></div>
			<div class="col-md-4 user_status"></div>
		</div>


		<div class="col-lg-3 col-md-6">
			<div class="mt-3">
				<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasEnd"
					aria-controls="offcanvasEnd">
					<span>
						<i class="bx bx-plus me-0 me-sm-1"></i>
						<span class="d-none d-sm-inline-block">프로젝트 수정</span>
					</span>
				</button>
				<button class="btn btn-primary" type="button">
					<span>
						<i class="bx bx-plus me-0 me-sm-1"></i>
						<span class="d-none d-sm-inline-block">멤버 추가생성</span>
					</span>
				</button>
				<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasEnd" aria-labelledby="offcanvasEndLabel">
					<div class="offcanvas-header">
						<h5 id="offcanvasEndLabel" class="offcanvas-title">프로젝트 생성</h5>
						<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
					</div>
					<div class="offcanvas-body  mx-0 flex-grow-0">


						<form id="byForm" action="/adminproject" method="POST">
							<div class="modal-body">
								<div class="row">
									<div class="col mb-3 test">
										제1영역
										<div id="orgTreeContainer"></div>
										사원, 부서 검색영역
									</div>
									<div class="col mb-0 test">제2영역
										<button type="button" id="remove">비우기</button>
										<br />
										프로젝트명 <br />
										<input type="text" id="proNm" name="proNm" /><br>
										프로젝트 시작일<br>
										<input type="date" id="proBdate" name="proBdate" value="" required><br>
										프로젝트 종료일 <br>
										<input type="date" id="proEdate" name="proEdate" value="" required><br> <br>
										<h5>참여자 명단</h5>
										<hr>
										<div id="orgTreeResult"></div>
									</div>
								</div>
							</div>

							<button type="submit" class="btn btn-primary mb-2 d-grid w-100" id="pbtn4">프로젝트 생성</button>
							<security:csrfInput />
						</form>

						<button type="button" class="btn btn-label-secondary d-grid w-100" data-bs-dismiss="offcanvas">
							Cancel
						</button>
					</div>
				</div>
			</div>
		</div>
		<br />

		<div class="card-datatable table-responsive">
			<table class="table">
				<thead class="table-light">
					<tr>
						<th>프로필사진</th>
						<th>사번</th>
						<th>이름</th>
						<th>부서</th>
						<th>이메일</th>
						<th>내선번호</th>
						<th>휴대폰번호</th>
						<th>역할</th>
						<th style="padding-left: 65px;">삭제</th>
					</tr>
				</thead>
				<tbody class="table-border-bottom-0">
					<c:if test="${empty paging.dataList }">
						<tr>
							<td colspan="6">검색 조건에 맞는 게시글 없음 </td>
						</tr>
					</c:if>
					<c:if test="${not empty paging.dataList }">

						<c:forEach items="${paging.dataList }" var="adchar">
							<tr>
								<c:if test="${not empty adchar.emp.empProfileImg }">
									<td>
										<img src='${adchar.emp.empProfileImg }' style='height: 46px; width:46px;' />
									</td>
								</c:if>
								<c:if test="${empty adchar.emp.empProfileImg }">
									<td>
										<img src='/resources/images/basic.png' style='height: 46px; width:46px;' />
									</td>
								</c:if>
								<td>
									${adchar.emp.empCd }
									<input class="tempEmp" type="hidden" value="${adchar.emp.empCd }"/>
								</td>
								<td>${adchar.emp.empName }</td>
								<td>${adchar.emp.deptCd }</td>
								<td>${adchar.emp.empMail }</td>
								<td>${adchar.emp.empExtension }</td>
								<td>${adchar.emp.empTelno }</td>
								<td>
									<c:choose>
										<c:when test="${adchar.proLeader eq 'Y'}">리더</c:when>
										<c:when test="${adchar.proLeader eq 'N'}">팀원</c:when>
										<c:otherwise>상태 미정</c:otherwise>
									</c:choose>
								</td>
								<td>${adchar.emp.empCd }</td>
								<td>${adchar.proSn }</td>
								<td>
									<div style="text-align: right;">
										<input id="proSn" type="TEXT" name="proSn" value="${adchar.proSn}" />
										<input class="empCdad" type="TEXT" name="empCd" value="${adchar.emp.empCd }" />
										<a href="javascript:;" onclick="deleteFunction()" class="btn btn-danger">삭제</a>
									</div>
								</td>
							</tr>
						</c:forEach>








					</c:if>
				</tbody>

				<tfoot>
					<tr>
						<td colspan="5">
							${paging.pagingHTML }
							<div id="searchUI" class="row g-3 d-flex justify-content-center">
								<div class="col-auto">
									<form:select path="simpleCondition.searchType" class="form-select">
										<form:option label="전체" value="" />
										<form:option label="이름" value="title" />
									</form:select>
								</div>
								<div class="col-auto">
									<form:input path="simpleCondition.searchWord" placeholder="검색키워드" class="form-control" />
								</div>
								<div class="col-auto">
									<input type="button" value="검색" id="searchBtn" class="btn btn-primary" />
								</div>
							</div>
						</td>
					</tr>
				</tfoot>
			</table>
		</div>
	</div>
</div>
<!-- 히든태그 사용 -->
<form:form modelAttribute="simpleCondition" method="get" id = "searchForm" class = "border" >
	<form:hidden path="searchType" readonly="readonly" placeholder="searchType"/>
	<form:hidden path="searchWord" readonly="readonly" placeholder="searchWord"/>
	<input type="hidden" name="page" readonly="readonly" placeholder="page"/>
</form:form>

<script>


function deleteFunction() {
	
	
	var empCdInputs = document.querySelectorAll('.empCdad');
	
	empCdInputs.forEach(function(element) {
		  var defaultValue = element.defaultValue;
		  console.log(defaultValue); // 각 요소의 defaultValue 값 출력
		});
	 
	console.log("i am so sad",document.querySelectorAll(".empCdad"));
	console.log("where is empCd",empCd);
	
	var proSn = $("#proSn").val();
	var empCd =$('.tempEmp').val();

	let pmemberVO ={
			empCd: empCd,
			proSn: proSn
		}
	
	console.log("pmemdel==={}",pmemberVO)
	
	$.ajax({
		type: "DELETE", 
		url: "/adminproject", 
		data: JSON.stringify(pmemberVO),
		contentType: 'application/json; charset=utf-8', 
		dataType: "json",
		success: function(resp){
			console.log("9999999",resp);
			alert("전송 성공"); 
			if (resp.msg == "OK") {
				
				alert("전송 성공");
				
			} else { 
				alert("전송 실패"); 
			}
		},
		error: (xhr) => {
			console.log(xhr.status);
			
		}
	})
	
    if (confirm("정말로 삭제하시겠습니까?")) {
        document.getElementById("deleteForm" + empCd).submit(); 
    }
}  



	function fn_paging(page) {
		searchForm.page.value = page;
		searchForm.requestSubmit();
	}
	$(searchUI).on("click", "#searchBtn", function(event){
		let inputs = $(this).parents("#searchUI").find(":input[name]");
		$.each(inputs, function(idx, ipt){
			let name = ipt.name;
			let value = $(ipt).val();
			$(searchForm).find(`:input[name=\${name}]`).val(value);
			$(searchForm).submit();
		});
	}); 

</script>