<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="kr.or.ddit.cal.dao.CalDAO">
	

	<!-- 해당 직원 일정 조회 -->
	<select id="selectList" parameterType="String" resultType="CalendarVO">
		SELECT
		    SCHEDULE_CD,
		    SCHEDULE_SJ,
		    SCHEDULE_CN,
		    SCHEDULE_BGN_DT,
		    SCHEDULE_END_DT,
		    SCHEDULE_PLACE,
		    EMP_CD,
		    SCHEDULE_ALARM_YN,
		    SCHEDULE_BCOLOR,
		    SCHEDULE_FCOLOR,
		    SCHEDULE_DAY_YN,
		    JOB_SN,
		    PRO_SN
		FROM
		    SCHEDULE
		WHERE
		    EMP_CD = #{empCd} OR SUBSTR(SCHEDULE_CD,1,1)='C'
	</select>
	
	<!-- 공통 코드 사용( 분류 ) -->
	<select id="selectListType" resultType="CommonVO">
		SELECT
		    COMMON_CODE_CD,
		    COMMON_CODE_UPPER_CD,
		    COMMON_CODE_SJ,
		    COMMON_CODE_ENGL_SJ,
		    COMMON_CODE_USE_AT
		FROM
		    COMMON_CODE
		WHERE     
   			COMMON_CODE_UPPER_CD = 'CAL'    
	</select>
	
	<!-- 해당 분류 선택 시 코드 (MAX +1) -->
	<select id="selectType" parameterType="String" resultType="String">		
		SELECT #{commonCodeCd} || '_' || TO_CHAR(SYSDATE, 'YYMMDD') || '_' || LPAD(SUBSTR(MAX(SCHEDULE_CD),10,3)+1, 3, '0') SCHEDULE_CD
		FROM SCHEDULE
		WHERE SUBSTR(SCHEDULE_CD,1,1)=#{commonCodeCd}
	</select>
	
	<!-- 상세 일정 조회 -->
	<select id="detailCal" parameterType="String" resultType="CalendarVO">
		SELECT
		    SCHEDULE_CD,
		    SCHEDULE_SJ,
		    SCHEDULE_CN,
		    SCHEDULE_BGN_DT,
		    SCHEDULE_END_DT,
		    SCHEDULE_PLACE,
		    EMP_CD,
		    SCHEDULE_ALARM_YN,
		    SCHEDULE_BCOLOR,
		    SCHEDULE_DAY_YN,
		    JOB_SN,
		    PRO_SN,
		    SCHEDULE_FCOLOR
		FROM
		    SCHEDULE
		    WHERE
		    SCHEDULE_CD = #{scheduleCd} 
	</select>
	
	<!-- 일정 추가 -->
	<insert id="insertCal" parameterType="CalendarVO">
		INSERT INTO SCHEDULE (
		    SCHEDULE_CD, SCHEDULE_SJ, SCHEDULE_CN
		    , SCHEDULE_BGN_DT, SCHEDULE_END_DT, SCHEDULE_PLACE
		    , EMP_CD, SCHEDULE_ALARM_YN, SCHEDULE_BCOLOR, SCHEDULE_FCOLOR
		    , SCHEDULE_DAY_YN, JOB_SN, PRO_SN
		) VALUES (
		    #{scheduleCd}
		    , #{scheduleSj}
		    , #{scheduleCn}
		    , #{scheduleBgnDt}
		    , #{scheduleEndDt}
		    , #{schedulePlace}
		    , #{empCd}
		    , #{scheduleAlarmYn}
			, <choose>
			    <when test='searchCd == "C"'> '#f8fdb4' </when>
			    <when test='searchCd == "D"'> '#c9c8f9' </when>
			    <when test='searchCd == "I"'> '#ffccd1' </when>
			    <when test='searchCd == "P"'> '#ccffd9' </when>
			    <otherwise> 'BLACK' </otherwise>
			</choose>
		    , #{scheduleFcolor}
		    , #{scheduleDayYn}
		    , #{jobSn}
		    , #{proSn} 
		 )
	</insert>
	
	<!-- 일정 삭제 -->
	<delete id="deleteCal" parameterType="String">
		DELETE FROM SCHEDULE
		WHERE
	        SCHEDULE_CD = #{scheduleCd} 
	</delete>
	
	<!-- 일정 수정 -->
	<update id="updateCal" parameterType="CalendarVO">
		UPDATE SCHEDULE 
	    SET 
	        SCHEDULE_SJ = #{scheduleSj}
	        ,SCHEDULE_CN = #{scheduleCn}
	        ,SCHEDULE_BGN_DT = #{scheduleBgnDt}
	        ,SCHEDULE_END_DT = #{scheduleEndDt}
	        ,SCHEDULE_PLACE = #{schedulePlace}
	        ,EMP_CD = #{empCd}
	        ,SCHEDULE_ALARM_YN = #{scheduleAlarmYn}
	        ,SCHEDULE_BCOLOR =        
	        <choose>
	            <when test="scheduleCd != null and scheduleCd.startsWith('C')"> '#f8fdb4' </when>
	            <when test="scheduleCd != null and scheduleCd.startsWith('D')"> '#c9c8f9' </when>
	            <when test="scheduleCd != null and scheduleCd.startsWith('I')"> '#ffccd1' </when>
	            <when test="scheduleCd != null and scheduleCd.startsWith('P')"> '#ccffd9' </when>
	            <otherwise> 'BLACK' </otherwise>
	        </choose>
	        ,SCHEDULE_FCOLOR = #{scheduleFcolor}
	        ,SCHEDULE_DAY_YN = #{scheduleDayYn}
	        ,JOB_SN = #{jobSn}
	        ,PRO_SN = #{proSn}
	    WHERE
	        SCHEDULE_CD = #{scheduleCd}
	</update>
</mapper>